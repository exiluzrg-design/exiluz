// =======================================================
//  CARRITO EXILUZ
// =======================================================

const CART_KEY = "exiluz_cart_qty";
const UNIT_PRICE = 18000; // precio base
const DISCOUNT_15 = 2;  // 15% desde 2 unidades
const DISCOUNT_20 = 3;  // 20% desde 3 unidades

// Leer cantidad del localStorage
function getQty() {
  return parseInt(localStorage.getItem(CART_KEY)) || 0;
}

// Guardar cantidad
function setQty(n) {
  localStorage.setItem(CART_KEY, n);
  updateCartCount();
}

// Mostrar numerito en el header
function updateCartCount() {
  const el = document.getElementById("cart-count");
  if (el) el.textContent = getQty();
}

// Render del carrito
function renderCart() {
  const qty = getQty();
  const empty = document.getElementById("cart-empty");
  const content = document.getElementById("cart-content");
  const box = document.getElementById("cart-items-container");

  if (qty < 1) {
    empty.style.display = "block";
    content.style.display = "none";
    return;
  }

  empty.style.display = "none";
  content.style.display = "flex";

  // üî• PRODUCTO EN CARRITO (IMAGEN CORREGIDA!)
  box.innerHTML = `
    <div class="cart-item">
      <div class="item-left">
        <img class="cart-img" src="assets/img/banners/p1.webp" alt="Llavero Elijo Creer">
        <div class="item-info">
          <h3>Llavero Elijo Creer</h3>
          <p>Badge electr√≥nico con 3 estrellas</p>
        </div>
      </div>

      <div class="item-qty">
        <button class="qty-btn" id="minus">-</button>
        <span id="qty">${qty}</span>
        <button class="qty-btn" id="plus">+</button>
      </div>

      <span id="price">${format(UNIT_PRICE)}</span>
      <span id="subtotal">${format(UNIT_PRICE * qty)}</span>
    </div>
  `;

  updateTotals(qty);

  // Eventos + y -
  document.getElementById("minus").onclick = () => { if(qty>1){ setQty(qty-1); renderCart(); }};
  document.getElementById("plus").onclick  = () => { setQty(qty+1); renderCart(); };
}

// Totales / descuentos
function updateTotals(qty) {
  let subtotal = UNIT_PRICE * qty;
  let total = subtotal;
  let discount = 0;

  if (qty >= DISCOUNT_20) discount = subtotal * 0.20;
  else if (qty >= DISCOUNT_15) discount = subtotal * 0.15;

  total = subtotal - discount;

  document.getElementById("summary-subtotal").textContent = format(subtotal);
  document.getElementById("summary-discount").textContent = "-$" + discount.toLocaleString("es-AR");
  document.getElementById("summary-total").textContent = format(total);
}

// Formato pesos
function format(n){
  return "$" + n.toLocaleString("es-AR");
}

// Init
updateCartCount();
renderCart();
